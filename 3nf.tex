\section{Progettazione di una base di dati}
\subsection{Anomalie}
Si immagini di dover progettare una base di dati relazionale contenente i dati degli 
studenti e dei corsi di un'Università. La soluzione più immediata è di creare un'unica
relazione
\begin{center}
  $Universit\grave{a}(Matr, Nome, Citt\grave{a}, Prov, C\#, Titolo, Docente, C\_laurea,
  Data, Voto)$ 
\end{center}

in cui una tupla $(m, n, c, p, C, t, D, l, d, v)$ rappresenta il fatto che uno studente
con matricola $m$ e nome $n$, residente nella città $c$ che si trova in provincia di $p$,
ha sostenuto l'esame del corso, con codice $C$ e titolo $t$, tenuto dal docente $D$, del 
corso di laurea $l$ in data $d$ riportando il voto $v$.\\\\
Adottando questa soluzione si avrebbero un certo numero di inconvenienti che vanno sotto 
il nome di \textbf{anomalia}. Un anomalia è essenzialmente un comportamento \emph{inaspettato
e indesiderato} da parte della base di dati, generato in risposta ad un'operazione. Le anomalie 
più comuni (spiegate relativamente all'esempio) sono:
\begin{itemize}
 \item \textbf{anomalie di inserimento}: non si possono inserire i dati di uno studente 
 se non ha sostenuto almeno un esame;
 \item \textbf{anomalie di cancellazione}: se si cancellano i dati di un corso (perché il
 corso è stato disattivato) e c'è uno studente che ha sostenuto solo l'esame relativo a 
 quel corso, perdo le informazioni sullo studente;
 \item \textbf{anomalie di aggiornamento}: se devo modificare il docente di un corso devo 
 farlo per ogni tupla in cui compare il corso;
 \item \textbf{ridondanza} dei dati: le informazioni anagrafiche di uno studente sono
  ripetute per ogni esame sostenuto dallo studente.
\end{itemize}
Queste anomalie sono dovute al fatto che si sono rappresentati in un'unica relazione più 
\emph{concetti}: il concetto ``Studente'', ``Corso'' ed ``Esame''. Rappresentando i tre 
concetti in tre relazioni distinte
\begin{center}
  $Studente(Matr, Nome, Citt\grave{a}, Prov)$\\
  $Corso(C\#, Titolo, Docente, C\_laurea)$\\
  $Esame(Matr, C\#, Data, Voto)$
\end{center}

tali anomalie vengono eliminate. Tuttavia è possibile riscontrare il permanere di simili 
anomalie concernenti le città:per eliminare queste ultime anomalie che hanno la stessa 
origine di quelle viste precedentemente, posso utilizzare lo \emph{schema} seguente:
\begin{center}
  $Studente(Matr,Nome,Citt\grave{a})$\\
  $Comune(Citt\grave{a},Prov)$\\
  $Corso(C\#,Titolo,Docente, C\_laurea)$\\
  $Esame(Matr, C\#, Data,Voto)$
\end{center}

\subsection{La Terza Forma Normale}
Si è constatato che ci sono schemi migliori di altri. Esistono dunque \emph{regole 
e proprietà formali} che ci permettono di costruire un \emph{buono} schema?\\
Se si analizzano le anomalie nella relazione $Universit\grave{a}$ si nota che sono 
legate al fatto che
\begin{itemize}
 \item $Voto$ e $Data$ sono \emph{determinati univocamente} da $Matr$ e $C\#$;
 \item  i dati di uno studente sono \emph{determinati univocamente} da $Matr$;
 \item i dati di un corso sono \emph{determinati univocamente} da $C\#$.
\end{itemize}
Il concetto di ``determina univocamente'' è colto dal concetto formale di \textbf{dipendenza funzionale}.
\begin{defn}
  Dato uno schema di relazione $R$, una \emph{dipendenza funzionale} su $R$ 
  è una coppia ordinata di sottoinsiemi non vuoti $X$, $Y$ $\in R$ e viene denotata 
  come $X \rightarrow Y$.
\end{defn}
\begin{prop}
Un'istanza $r$ di $R$ \emph{soddisfa} la dipendenza funzionale $X \rightarrow Y$
se per ogni coppia di tuple $t_1$, $t_2$ $\in r$ si ha che se $t_1[X] = t_2[X] 
\Rightarrow t_1[Y] = t_2[Y]$. 
\end{prop}
In simboli:
\begin{center}
\begin{math}
(\ \forall (t_1, t_2) \in r\ t.c.\ t_1[X] = t_2[X] \Rightarrow t_1[Y] = t_2[Y]) 
\Rightarrow (X\rightarrow Y
\end{math}
soddisfa $r$).
\end{center}
Sia $F$ un insieme di dipendenze funzionali su $R$ ed $r$ un'istanza di $R$. Se $r$ 
soddisfa tutte le dipendenze in $F$, diciamo che $r$ è un'istanza \emph{legale} di $R$. 
\begin{defn}
La \emph{chiusura di F}, denotata con $F^+$, è l'insieme di dipendenze funzionali che 
sono soddisfatte da ogni istanza legale di $R$. 
\end{defn}

Banalmente si ha che $F$ $\subseteq$ $F^+$.\\
\begin{defn}
 Dato uno schema di relazione $R$, un insieme di dipendenze funzionali $F$ su $R$ e un
sottoinsieme $K$ di $R$, diciamo che $K$ è una \textbf{chiave} per $R$ se:
\begin{itemize}
 \item $K \rightarrow R \in F^+$
 \item $\forall K'\subset K,\ K'\rightarrow R \notin F^+$.
\end{itemize}
\end{defn}
In pratica una chiave è il minimo sottoinsieme di $R$ che determina univocamente il 
valore dei restanti attributi di $R$ (banalmente la chiave determina se stessa e i 
suoi sottoinsiemi) tale che, se prendessimo un suo sottoinsieme, esso non sarebbe 
chiave.\\
In futuro denoteremo con $A_1, A_2, \ldots, A_n$ un insieme di attributi, con $X$ 
e $Y$ sottoinsiemi di $R$, con $XY$ l'insieme $X$ $\cup$ $Y$.

\begin{exmp}
 Considerando il precendente schema $Universit\grave{a}$, possiamo osservare che un'istanza 
 di \emph{Università} per rispecchiare la realtà di interesse deve soddisfare le seguenti 
 dipendenze funzionali:
 \begin{itemize}
  \item $Matr,\ C\# \rightarrow Nome,\ Citt\grave{a},\ Prov,\ Titolo,\ Docente,\ C\_laurea,
  \ Data,\ Voto$;
  \item $C\# \rightarrow Titolo,\ Docente,\ C\_laurea$
  \item $Matr \rightarrow Nome\, Citt\grave{a},\ Prov$
  \item $Citt\grave{a} \rightarrow Prov$
 \end{itemize}
 Quindi $\{Matr, C\#\}$ costituisce una \emph{chiave} per Università.
\end{exmp}

Ci sono attributi che \textbf{dipendono parzialmente} dalla chiave. Nell'esempio [4.1] 
\{$Titolo$, $Docente$, $C\_laurea$\} dipendono funzionalmente da $C\#$; altri attributi
invece \textbf{dipendono transitivamente} dalla chiave, ad esempio $Prov$ dipende
funzionalmente da $Matr$ in quanto $Matr \rightarrow Citt\grave{a} \rightarrow Prov$.\\
Prendendo lo schema finale, vediamo che in nessuno schema di relazione ci sono attributi
che dipendono parzialmente né transitivamente dalla chiave. 
\begin{prop}
Uno schema di relazione in cui non ci sono sono attributi che dipendono parzialmente né 
transitivamente dalla chiave è detto in \textbf{Terza Forma Normale} (3NF). 
\end{prop}
Formalizziamo i concetti appena introdotti:
\begin{defn}
 Dati uno schema di relazione $R$ e un insieme di dipendenze funzionali $F$ su $R$
diciamo che:
\begin{itemize}
 \item un attributo $A$ $\in$ $R$ è \textbf{primo} se appartiene ad una chiave di $R$;
 \item un sottoinsieme $X$ $\subset$ $R$ è una \textbf{superchiave} se contiene una 
 chiave di $R$.
\end{itemize}
\end{defn}
Nell'esempio [4.1], considerando la relazione \emph{Università}, $Matr$ è primo mentre
 \{$Matr$, $C\#$, $Nome$\} è una superchiave.
\begin{defn}
Siano $R$ uno schema di relazione ed $F$ un insieme di dipendenze funzionali su $R$.
\begin{itemize}
 \item $X\rightarrow A$ $\in F^+$ è una dipendenza parziale su $R$ se $A$ non 
 è primo e $X$ è contenuto propriamente in una chiave di R.
 \item $X\rightarrow A$ $\in F^+$ è una dipendenza transitiva su $R$ se $A$ 
 non è primo e $\forall K \subset R$ si ha che $X$ non è contenuto propriamente 
 in $K$ e $K-X \neq \emptyset$.
\end{itemize}
\end{defn}
\begin{prop}
Siano $R$ uno schema di relazione ed $F$ un insieme di dipendenze funzionali su $R$. 
$R$ è in 3NF se, $\forall (X\rightarrow A) \in F^+$ t.c. $A\notin X$, si ha che $A$ è
primo oppure $X$ è una superchiave.
\end{prop}
\begin{theo}
Siano $R$ uno schema di relazione e $F$ un insieme di dipendenze funzionali su $R$. Uno
schema $R$ è in 3NF se e solo se non esistono né dipendenze parziali né dipendenze 
transitive in $R$.
\end{theo}
\textbf{Dimostrazione.} La parte \emph{solo se} deriva banalmente dalla definizione [4.5].\\
Parte \emph{se.} Supponiamo per assurdo che $R$ non sia in 3NF nonostante non ci siano
dipendenze parziali o transitive; in tal caso esiste una dipendenza funzionale $X\rightarrow A$
$\in F^+$ t.c. $A$ non è primo e $X$ non è una superchiave. Poiché $X$ non è una
superchiave due casi (mutuamente esclusivi) sono possibili:
\begin{itemize}
 \item o per ogni chiave $K$ di $R$, $X$ non è contenuto propriamente in $K$ e $K-X \neq 
 \emptyset$; in tal caso $X\rightarrow A$ è una dipendenza transitiva su $R$ (contraddizione)
 \item oppure esiste una chiave $K$ di $R$ t.c. $X \subset K$; in tal caso $X\rightarrow A$ 
 è una dipendenza parziale su $R$ (contraddizione). $\Box$
\end{itemize}
Un obbiettivo da tenere presente quando si progetta una base di dati è quello di produrre 
uno schema in cui ogni relazione sia in 3NF. Nella fase di progettazione concettuale si 
individuano i concetti che devono essere rappresentati nella base di dati. Se questo lavoro 
di individuazione è fatto accuratamente lo schema relazionale che può essere derivato in modo
automatico con opportune regole, è in 3NF. Se tuttavia dopo tale processo ci trovassimo a 
produrre uno schema che non è in 3NF dovremmo procedere ad una fase di decomposizione.

\subsection{Decomposizione di schemi di relazione}
Uno schema che non è in 3NF può essere decomposto in più modi in un insieme di schemi in 3NF.\\
 Sia $R = ABC$ con l'insieme di dipendenze funzionali $F = \{A\rightarrow B, B\rightarrow C\}$.
$R$ non è in 3NF per la presenza in $F^+$ della dipendenza transitiva $B\rightarrow C$, ma può 
essere decomposto in:
\begin{center}
  $R_1 = AB$ con $F_1=\{A\rightarrow B\}$\\
  $R_2 = BC$ con $F_2=\{B\rightarrow C\}$\\
  oppure\\
  $R_1 = AB$ con $F_1=\{A\rightarrow B\}$\\
  $R_2 = AC$ con $F_2=\{A\rightarrow C\}$\\
\end{center}
Entrambi gli schemi sono in 3NF, tuttavia la seconda soluzione non è soddisfacente. Infatti,
si consideri l'istanza della \emph{base di dati} costituita dalle due istanze legali di $R_1$ e $R_2$:

    \begin{multicols}{2}   
    \begin{flushright}
    \begin{tabular}{l|l}
     A & B \\
     \hline
     $a_1$ & $b_1$\\
     $a_2$ & $b_1$
    \end{tabular}
    \end{flushright}

    \begin{flushleft}
    \begin{tabular}{l|l}
     A & C \\
     \hline
     $a_1$ & $c_1$\\
     $a_2$ & $c_2$
    \end{tabular}
    \end{flushleft}
    \end{multicols}  
 
  L'istanza di R che si può ricostruire da questa tramite \emph{join naturale} è\\
    \begin{center}
    \begin{tabular}{l|l|l}
     A & B & C \\
     \hline
     $a_1$ &$b_1$ & $c_1$\\
     $a_2$ &$b_1$ & $c_2$
    \end{tabular}
    \end{center}
    
    non è un'istanza legale di $R$, in quanto non soddisfa la dipendenza funzionale
    $B\rightarrow C$.

 \begin{exmp}
  Si consideri la relazione $Studente = \{Matr, Com, Prov\}$, con $F = $ \{$Matr\rightarrow Com$,
  $Matr\rightarrow Prov$, $Com\rightarrow Prov$\}; essa è in 3FN. Una decomposizione possibile è
  la seguente:
  \begin{center}
    $R_1 = \{Matr, Com\}$ con $F_1 = \{Matr\rightarrow Com\}$ \\
    $R_2 = \{Matr, Prov\}$ con $F_2 = \{Matr\rightarrow Prov\}$ \\
   \end{center}
  entrabe sono in 3FN; si cosiderino le seguenti istanze di $R_1$ e $R_2$
  \begin{multicols}{2}
  \begin{flushright} 
  \begin{tabular}{l | l }
  Matr & Com\\
  \hline
  $O_1$ & Marino\\
  $O_2$ & Marino
 \end{tabular}
 \end{flushright}
  
  \begin{flushleft}
   \begin{tabular}{ l | l}
  Matr & Prov \\
  \hline
  $O_1$ & Parma\\
  $O_2$ & Latina
 \end{tabular}
\end{flushleft}
\end{multicols}
e si provi a fare il join naturale per riottenere lo schema di partenza. Ecco il
risultato:
  \begin{center} 
  \begin{tabular}{l | l | l}
  Matr & Com & Prov\\
  \hline
  $O_1$ & Marino & Parma\\
  $O_2$ & Marino & Latina
 \end{tabular}
 \end{center}
 
 chiaramente si perde la dipendenza funzionale $Com\rightarrow Prov$.
\end{exmp}
Una istanza di una relazione contiene i dati di una certa realtà che lo schema della 
base di dati intende rappresentare e si assumono come riferimenti veritieri. Pertanto 
quando si decompone uno schema si vuole che ogni sua istanza sia ricostruibile da 
un'istanza dello schema ottenuto dalla decomposizione.
\begin{prop}
Una decomposizione di uno schema di relazione deve avere i seguenti requisiti:
\begin{itemize}
 \item deve preservare le dipendenze funzionali che valgono su ogni istanza legale dello 
 schema originario;
 \item deve permettere di ricostruire mediante join naturale ogni istanza legale 
 dello schema originario.
\end{itemize} 
\end{prop}

\subsection{Decomposizioni che preservano le dipendenze}
Quando si decompone uno schema di relazione in $R$ su cui è definito un insieme di 
dipendenze funzionali $F$, le dipendenze funzionali che si vogliono preservare sono
tutte quelle che sono soddisfatte da ogni istanza legale di $R$, cioè le dipendenze
funzionali in $F^+$; sarà quindi necessario calcolare tale insieme.

\begin{defn}
Sia $R$ uno schema di relazione e $F$ un insieme di dipendenze funzionali. Sia $F^A$ l'insieme
di dipendenze funzionali definito nel modo seguente:
\begin{itemize}
 \item $f \in F \Rightarrow f \in F^A$;
 \item $Y \subseteq X \subseteq R \Rightarrow X\rightarrow Y \in F^A$ (\textbf{assioma della riflessività});
 \item $X \rightarrow Y \in F^A \Rightarrow XZ\rightarrow YZ \in F^A$, $\forall Z\subseteq R$ 
 (\textbf{assioma dell'aumento});
 \item $X \rightarrow Y \in F^A, Y \rightarrow Z \in F^A \Rightarrow X \rightarrow Z \in F^A$ 
 (\textbf{assioma della transitività}).
\end{itemize}
\end{defn}
Dimostreremo che $F^+=F^A$, cioè che la chiusura di un insieme di dipendenze funzionali $F$ può essere
ottenuta a partire da $F$ applicando ricorsivamente gli assiomi della riflessività, dell'aumento e della
transitività, conosciuti come \textbf{assiomi di Armstrong}.

\begin{theo}
Sia $F$ un insieme di dipendenze funzionali. Valgono le seguenti implicazioni:
\begin{itemize}
 \item \textbf{regola dell'unione: } $X\rightarrow Y \in F^A$ e $X\rightarrow Z \in F^A$ $\Rightarrow$ 
 $X\rightarrow YZ \in F^A$
 \item \textbf{regola della decomposizione: } $X\rightarrow Y \in F^A$ e $Z\subseteq Y$ $\Rightarrow$ 
 $X\rightarrow Z \in F^A$
 \item \textbf{regola della pseudotransitività: }$X\rightarrow Y \in F^A$ e $WY\rightarrow Z \in F^A 
 \Rightarrow WX\rightarrow Z \in F^A$.
\end{itemize}
\end{theo}
\textbf{Dimostrazione.}
\begin{itemize}
 \item \emph{Regola dell'unione.} Se $X\rightarrow Y \in F^A$, per l'assioma dell'aumento si ha $X\rightarrow 
 XY \in F^A$. Analogamente, se $X\rightarrow Z \in F^A$, sempre per l'assioma dell'aumento si ha $XY 
 \rightarrow YZ \in F^A$. Quindi, poiché $X \rightarrow XY \in F^A$ e $XY \rightarrow YZ \in F^A$, 
 per l'assioma della transitività si ha $X \rightarrow YZ \in F^A$.
 \item \emph{Regola della decomposizione.} Se $Z \subseteq Y$ allora, per l'assioma della riflessività, si ha 
 $Y \rightarrow Z \in F^A$. Quindi, poiché $X \rightarrow Y \in F^A$ e $Y \rightarrow Z \in F^A$, per l'assioma
 della transitività si ha $X\rightarrow Z \in F^A$.
 \item \emph{Regola della pseudotransitività.} Se $X \rightarrow Y \in F^A$, per l'assioma dell'aumento si 
 ha $WX \rightarrow WY \in F^A$. Quindi, poiché $WX \rightarrow WY \in F^A$ e $WY \rightarrow Z \in F^A$, 
 per l'assioma della transitività si ha $WX\rightarrow Z \in F^A$. $\Box$
\end{itemize}

Si osservi che, per la regola dell'unione, se $X\rightarrow A_i \in F^A$,$\forall i \in \{1, \ldots,n\}$, 
allora $X \rightarrow A_1, A_2, \ldots, A_n \in F^A$ e che, per la regola della decomposizione, 
se $X \rightarrow A_1, A_2, \ldots, A_n \in F^A$ allora $X\rightarrow A_i \in F^A$, $\forall i \in \{1, 
\ldots, n\}$; cioè:
\begin{center}
 \begin{math}
  X\rightarrow A_1, A_2, \ldots, A_n \in F^A \Leftrightarrow X \rightarrow A_i \in F^A, \forall i \in \{1, \ldots, n\}.
 \end{math}
\end{center}

Pertanto, possiamo limitarci, quando necessario, a considerare solo dipendenze funzionali in cui il
membro destro sia un \emph{singleton} (ovvero un solo attributo).

\subsubsection{Chiusura di un insieme di attributi}

Allo scopo di dimostrare che $F^+ = F^A$, introduciamo il concetto di \emph{chiusura} di un insieme di attributi
rispetto ad un insieme di dipendenze funzionali. 
\begin{defn}
Siano $R$ uno schema di relazione, $F$ un insieme di dipendenze funzionali su $R$ e $X$ un sottoinsieme di $R$.
La chiusura di $X$ rispetto ad $F$, denotata con $X^+_F$ (o semplicemente $X^+$, se non sorgono ambiguità) è 
definita nel modo seguente: $X^+_F = \{A\ t.c.\ X \rightarrow A \in F^A\}$.
\end{defn}
In parole povere, la chiusura di un insieme di attributi X è l'insieme di tutti gli attributi determinati da $X$
tramite dipendenze funzionali in $F^A$.
\label{lemma4_1}
\begin{lem}
Siano $R$ uno schema di relazione ed $F$ un insieme di dipendenze funzionali su $R$. Si ha che:
$X \rightarrow Y \in F^A \Leftrightarrow Y \subseteq X^+$.
\end{lem}

\textbf{Dimostrazione.} Sia $Y = A_1, A_2, \ldots, A_n$.\\
\emph{Parte se.} Poiché $Y \subseteq X^+$, si ha che $X \rightarrow A_i \in F^A, \forall i \in \{1, \ldots, n\}$. 
Pertanto, per la regola dell'unione, $X \rightarrow Y \in F^A$.\\
\emph{Parte solo se.} Poiché $X \rightarrow Y \in F^A$, per la regola della decomposizione si ha che, 
$X \rightarrow A_i \in F^A$, $\forall i \in \{1, \ldots, n\}$, cioè $A_i \in X^+, \forall i \in \{1, \ldots, n\}$ 
e, quindi, $Y \subseteq X^+$. $\Box$

\subsubsection{Uguaglianza tra $F^A$ e $F^+$}

Con le conoscenze acquisite finora siamo in grado di dimostrare che $F^+ = F^A$.
\begin{theo}
Siano $R$ uno schema di relazione ed $F$ un insieme di dipendenze funzionali su $R$. Si ha che $F^+ = F^A$.
\end{theo}
\textbf{Dimostrazione.} Mostreremo che $F^+ \subseteq F^A$ e contemporaneamente $F^+ \subseteq F^A$, equivalente
a dire che i due insiemi sono uguali.\\
$\mathbf{F^{\boldsymbol{+}} \boldsymbol{\subseteq} F^A}$. Sia $X \rightarrow Y$ una dipendenza funzionale in $F^A$.
Dimostriamo che $X\rightarrow Y \in F^+$ per induzione sul numero $i$ di applicazioni di uno degli assiomi di Armstrong.\\\\
\emph{Base dell’induzione}: $i=0$. In tal caso $X \rightarrow Y \in F$ e quindi, banalmente, 
$X \rightarrow Y \in F^+$.\\
\emph{Ipotesi induttiva}: Ogni dipendenza funzionale ottenuta a partire da $F$ applicando gli assiomi di 
Armstrong un numero di volte minore o uguale a $i–1$, con $i>0$, è in $F^+$.\\
\emph{Passo induttivo}: all'$i$-esimo passo si ha $X \rightarrow Y$, che è il risultato di uno dei seguenti 
tre casi:
\begin{itemize}
 \item  $X \rightarrow Y$ è stata ottenuta mediante l’assioma della riflessività, in tal caso $Y \subseteq X$. 
 Sia $r$ un’istanza di $R$ e siano $t_1$ e $t_2$ due tuple di $r$ tali che $t_1[X]=t_2[X]$; banalmente si ha 
 $t_1[Y] = t_2[Y]$. $X \rightarrow Y$ è dunque una dipendenza funzionale \emph{soddisfatta} da ogni istanza legale
 di $R$, e per definizione fa parte di $F^+$.
 \item $X \rightarrow Y$ è stata ottenuta applicando l’assioma dell’aumento ad una dipendenza funzionale 
 $V \rightarrow W \in F^A$, quest'ultima già inclusa per ipotesi induttiva in $F^+$, in uno dei passaggi 
 precenti all'attuale $i$-esimo; si ha quindi che $X = VZ$ e $Y = WZ$, per qualche $Z \subseteq R$.\\
 Sia $r$ un’istanza legale di $R$ e siano $t_1$ e $t_2$ due tuple di $r$ tali che:
 \begin{enumerate}
  \item $t_1[X] = t_2[X]$; banalmente si ha che $t_1[V] = t_2[V]$ e $t_1[Z] = t_2[Z]$
  \item per l’ipotesi induttiva da $t_1[V] = t_2[V]$ segue $t_1[W] = t_2[W]$
  \item da $t_1[W] = t_2[W]$ e $t_1[Z] = t_2[Z]$ segue $t_1[Y] = t_2[Y]$
 \end{enumerate}
\item $X \rightarrow Y$ è stata ottenuta applicando l’assioma della transitività a due dipendenze funzionali 
$X \rightarrow Z$ e $Z \rightarrow Y \in F^A$, ottenute applicando ricorsivamente gli assiomi di Armstrong 
un numero di volte minore o uguale a $i–1$. Sia $r$ un’istanza legale di $R$ e siano $t_1$ e $t_2$ due tuple 
di $r$ tali che $t_1[X] = t_2[X]$. Per l’ipotesi induttiva da $t_1[X] = t_2[X]$ segue $t_1[Z] = t_2[Z]$; da 
$t_1[Z] = t_2[Z]$, ancora per l’ipotesi induttiva, segue $t_1[Y] = t_2[Y]$.
\end{itemize}
$\mathbf{F^A \boldsymbol{\subseteq} F^{\boldsymbol{+}}}$. Si supponga per assurdo che esista una dipendenza 
funzionale $X \rightarrow Y \in F^+$ tale che $X \rightarrow Y \not\in F^A$. Si mostrerà che esiste 
un’istanza legale di $R$ che non soddisfa $X \rightarrow Y$ (contraddicendo allora il fatto che $X \rightarrow Y 
\in F^+$).\\
Consideriamo la seguente istanza $r$ di $R$:
\begin{center}
\includegraphics[width=250px]{img_4_4_2.eps} 
\end{center}
Mostriamo che:
\begin{itemize}
 \item $r$ è un’istanza legale di $R$. Sia $V \rightarrow W$ una dipendenza funzionale in $F$ e supponiamo
 per assurdo che non sia soddisfatta da $r$. In tal caso le due tuple di $r$ devono avere gli stessi valori
 per $V$ e differenti valori per $W$; ciò implica che $V \subseteq X^+$ e $W \cap (R-X^+)\not = \emptyset$.
 Poiché $V \subseteq X^+$, per il \linkto{lemma4_1}{Lemma 4.1}, si ha che $X \rightarrow V \in F^A$; pertanto,
 per l’assioma della transitività, $X \rightarrow W \in F^A$ e, quindi, per il Lemma 4.1,
 $W \subseteq X^+$ (che contraddice $W \cap (R-X^+)\not =\emptyset$).
 \item $r$ non soddisfa $X \rightarrow Y$. Supponiamo per assurdo che $r$ soddisfi $X \rightarrow Y$. Poiché 
 $X \subseteq X^+$ (per l’assioma della riflessività), le due tuple di $r$ coincidono sugli attributi $X$ 
 e quindi, poiché $r$ soddisfa $X \rightarrow Y$, devono coincidere anche sugli attributi $Y$. Questo implica
 che $Y \subseteq X^+$ e quindi, per il Lemma 4.1, che $X \rightarrow Y \in F^A$. $\Box$
\end{itemize}

\subsubsection{Algoritmo per calcolare $\mathbf{X^{\boldsymbol{+}}}$}
Per stabilire se una decomposizione preserva $F^+$, quest'ultimo va calcolato. Tale operazione potrebbe 
tuttavia richiedere tempo esponenziale dipendente da $|F|$; se $F = \{A \rightarrow B_1, A \rightarrow B_2,
\ldots, A \rightarrow B_n\}$, con $|F|=n$, per le regole della decomposizione e dell'unione si ha che 
$F^+ \supseteq \{A \rightarrow Z t.c. Z \subseteq B_1B_2\ldots B_n\} e quindi $|F^+| = 2^n-1$. D'altra parte,
per sapere se una decomposizione preserva le dipendenze, è sufficiente poter decidere se una dipendenza 
funzionale $X \rightarrow Y in F^+$; ciò può essere fatto calcolando $X^+$ e verificando se $Y \subseteq 
X^+$.\\ 
Il calcolo di $X^+$ può essere fatto mediante il seguente algoritmo polinomiale.
\begin{alg}
\textsc{Input:} uno schema di relazione $R$, un insieme $F$ di dipendenze funzionali su $R$, un sottoinsieme
$X$ di $R$.\\
\textsc{Output:} $X^+_F$ nella variabile $Z$\\\\
\textsc{Begin}\\
$Z\vcentcolon= X$;\\
$S\vcentcolon= \{A\ t.c.\ Y \rightarrow V \in F \wedge A \in V \wedge Y \subseteq Z\}$\\
\textsc{while} $S$ \not\subseteq Z\\
\indent \textsc{do}
\indent \textsc{begin}
\indent $Z\vcentcolon = Z \cup S$;\\
\indent $S\vcentcolon= \{A\ t.c.\ Y \rightarrow V \in F \wedge A \in V \wedge Y \subseteq Z\}$;\\
\indent \textsc{end}
\textsc{end}
\end{alg}


